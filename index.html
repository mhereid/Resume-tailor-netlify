<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Resume Tailor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- JSZip for DOCX generation -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <style>
    :root {
      --bg-main: #050b10;
      --bg-panel: #1f2933;
      --bg-input: #111827;
      --border-subtle: #3b4252;
      --text-primary: #f9fafb;
      --text-secondary: #9ca3af;
      --accent: #ff9900;
      --font-body: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-mono: "SF Mono", Menlo, Consolas, monospace;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 1rem;
      min-height: 100vh;
      font-family: var(--font-body);
      background: radial-gradient(circle at top left, #111827 0, #020617 50%, #000 100%);
      color: var(--text-primary);
      display: flex;
      justify-content: center;
    }

    .container { width: 100%; max-width: 1200px; }

    /* Top nav */
    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(15,23,42,.95);
      padding: .8rem 1rem;
      border-radius: .6rem;
      border: 1px solid rgba(148,163,184,.25);
      margin-bottom: 1rem;
    }

    .nav-title { font-weight: 600; }
    .nav-sub { font-size: .75rem; color: var(--text-secondary); }

    /* Layout */
    .layout {
      display: grid;
      gap: 1rem;
    }

    @media (min-width: 1024px) {
      .layout { grid-template-columns: 220px 1fr; }
    }

    /* Sidebar */
    .sidebar {
      background: rgba(15,23,42,.95);
      border-radius: .7rem;
      border: 1px solid rgba(148,163,184,.25);
      padding: .6rem;
    }

    .nav-link {
      display: block;
      padding: .5rem .6rem;
      border-radius: .4rem;
      font-size: .85rem;
      color: var(--text-secondary);
      text-decoration: none;
      cursor: pointer;
    }

    .nav-link.active {
      background: rgba(55,65,81,.8);
      color: var(--text-primary);
    }

    /* Cards */
    .card {
      background: rgba(15,23,42,.95);
      border-radius: .8rem;
      border: 1px solid rgba(148,163,184,.25);
      padding: 1.2rem;
    }

    /* Inputs */
    label {
      display: block;
      margin-top: .9rem;
      margin-bottom: .3rem;
      font-size: .75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    input, textarea {
      width: 100%;
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      padding: .6rem;
      border-radius: .5rem;
      color: var(--text-primary);
      font-size: .9rem;
    }

    textarea {
      min-height: 320px;
      font-family: var(--font-mono);
    }

    button {
      margin-top: .8rem;
      background: var(--accent);
      border: none;
      color: #111827;
      padding: .7rem 1rem;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: .85rem;
    }

    th, td {
      text-align: left;
      padding: .5rem;
      border-bottom: 1px solid rgba(148,163,184,.2);
    }

    a.link {
      color: var(--accent);
      text-decoration: none;
    }

    .muted {
      color: var(--text-secondary);
      font-size: .8rem;
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- Top bar -->
    <div class="nav">
      <div>
        <div class="nav-title">Resume Tailor</div>
        <div class="nav-sub">AWS-style • GPT powered</div>
      </div>
      <div class="muted">Prototype</div>
    </div>

    <div class="layout">

      <!-- Sidebar -->
      <aside class="sidebar">
        <a class="nav-link active" id="tabTailor">Tailor Resume</a>
        <a class="nav-link" id="tabHistory">History</a>
      </aside>

      <!-- Main panel -->
      <div>

        <!-- Tailor panel -->
        <div class="card" id="panelTailor">
          <label>Job Posting URL</label>
          <input id="jobUrl" placeholder="https://company.com/jobs/..." />

          <label>Mode</label>
          <select id="mode">
            <option value="full">Full Resume</option>
            <option value="one_page">One Page</option>
          </select>

          <button id="run">Generate Resume</button>

          <label>Output</label>
          <textarea id="output"></textarea>
        </div>

        <!-- History panel -->
        <div class="card" id="panelHistory" style="display:none;">
          <div id="historyContent" class="muted">Loading…</div>
        </div>

      </div>
    </div>
  </div>

  <script>
    const tabTailor = document.getElementById("tabTailor");
    const tabHistory = document.getElementById("tabHistory");
    const panelTailor = document.getElementById("panelTailor");
    const panelHistory = document.getElementById("panelHistory");
    const historyContent = document.getElementById("historyContent");

    function setTab(active) {
      [tabTailor, tabHistory].forEach(t => t.classList.remove("active"));
      active.classList.add("active");
    }

    tabTailor.onclick = () => {
      setTab(tabTailor);
      panelTailor.style.display = "block";
      panelHistory.style.display = "none";
    };

    tabHistory.onclick = async () => {
      setTab(tabHistory);
      panelTailor.style.display = "none";
      panelHistory.style.display = "block";
      loadHistory();
    };

    async function loadHistory() {
      historyContent.textContent = "Loading…";
      try {
        const res = await fetch("/.netlify/functions/history");
        const data = await res.json();
        const history = data.history || [];

        if (!history.length) {
          historyContent.textContent = "No history yet.";
          return;
        }

        historyContent.innerHTML = `
          <table>
            <thead>
              <tr>
                <th>Company</th>
                <th>Role</th>
                <th>Job</th>
                <th>Model</th>
                <th>Cost</th>
              </tr>
            </thead>
            <tbody>
              ${history.map(h => `
                <tr>
                  <td>${h.company}</td>
                  <td>${h.role}</td>
                  <td><a class="link" href="${h.jobUrl}" target="_blank">Link</a></td>
                  <td>${h.modelUsed}</td>
                  <td>${h.cost?.estimated_cost_usd
                    ? "$" + h.cost.estimated_cost_usd.toFixed(4)
                    : "—"}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        `;
      } catch {
        historyContent.textContent = "Failed to load history.";
      }
    }

    document.getElementById("run").onclick = async () => {
      const jobUrl = document.getElementById("jobUrl").value;
      const mode = document.getElementById("mode").value;
      const output = document.getElementById("output");

      output.value = "Generating…";

      const res = await fetch("/.netlify/functions/tailor-resume", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ jobUrl, mode })
      });

      const data = await res.json();
      output.value = data.resume || "";
    };
  </script>
</body>
</html>
